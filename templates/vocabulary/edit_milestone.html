{% extends "vocabulary/base_vocab.html" %}

{% block title %}Edit Goal - Sophia's Vocabulary Trainer{% endblock %}

{% block content %}
<div class="card">
    <h2 style="color: var(--primary-color); margin-bottom: 30px;">✏️ Edit Goal</h2>

    <form method="POST" action="{{ url_for('edit_milestone', milestone_id=milestone.id) }}">
        <div style="margin-bottom: 20px;">
            <label for="name" style="display: block; margin-bottom: 8px; font-weight: bold; color: var(--primary-color);">
                Goal Name:
            </label>
            <input type="text" id="name" name="name" required
                   value="{{ milestone.name }}"
                   placeholder="e.g., Summer Goal, PSAT Prep"
                   style="width: 100%; padding: 12px; border: 2px solid #E0E0E0;
                          border-radius: 10px; font-size: 16px; font-family: inherit;">
        </div>

        <div style="margin-bottom: 20px;">
            <label for="target_date" style="display: block; margin-bottom: 8px; font-weight: bold; color: var(--primary-color);">
                Target Date:
            </label>
            <input type="date" id="target_date" name="target_date" required
                   value="{{ milestone.target_date.strftime('%Y-%m-%d') }}"
                   style="width: 100%; padding: 12px; border: 2px solid #E0E0E0;
                          border-radius: 10px; font-size: 16px; font-family: inherit;">
        </div>

        <div style="margin-bottom: 30px;">
            <label for="target_words" style="display: block; margin-bottom: 8px; font-weight: bold; color: var(--primary-color);">
                Target Number of Words:
            </label>
            <input type="number" id="target_words" name="target_words" required min="1"
                   value="{{ milestone.target_words }}"
                   placeholder="e.g., 100"
                   onchange="calculateProgress()"
                   style="width: 100%; padding: 12px; border: 2px solid #E0E0E0;
                          border-radius: 10px; font-size: 16px; font-family: inherit;">
            <div id="progress-info" style="margin-top: 10px; padding: 10px; background: #f0f9ff; border-radius: 8px; font-size: 0.9em;">
                <p style="margin: 5px 0;">📊 Current words: <strong>{{ total_words }}</strong></p>
                <p style="margin: 5px 0;">📅 Days until target: <strong>{{ days_until }}</strong> days</p>
                <p style="margin: 5px 0;" id="words-needed">📝 Words needed: <strong>{{ words_needed if words_needed > 0 else 0 }}</strong></p>
                <p style="margin: 5px 0;" id="daily-rate">⏱️ Daily rate needed: <strong>{{ "%.1f"|format((words_needed if words_needed > 0 else 0) / (days_until if days_until > 0 else 1)) }}</strong> words/day</p>
            </div>
        </div>

        <div style="display: flex; gap: 10px; justify-content: center;">
            <button type="submit" class="btn" style="background: var(--primary-color);">
                ✅ Save Changes
            </button>
            <a href="{{ url_for('milestones') }}" class="btn" style="background: #95a5a6;">
                ❌ Cancel
            </a>
        </div>
    </form>
</div>

<script>
function calculateProgress() {
    const targetWords = parseInt(document.getElementById('target_words').value) || 0;
    const targetDate = document.getElementById('target_date').value;
    const currentWords = {{ total_words }};

    if (targetDate) {
        const target = new Date(targetDate);
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const daysUntil = Math.max(1, Math.ceil((target - today) / (1000 * 60 * 60 * 24)));

        const wordsNeeded = Math.max(0, targetWords - currentWords);
        const dailyRate = (wordsNeeded / daysUntil).toFixed(1);

        document.getElementById('words-needed').innerHTML = `📝 Words needed: <strong>${wordsNeeded}</strong>`;
        document.getElementById('daily-rate').innerHTML = `⏱️ Daily rate needed: <strong>${dailyRate}</strong> words/day`;

        // Update days until display
        const daysDisplay = document.querySelector('#progress-info p:nth-child(2)');
        if (daysDisplay) {
            daysDisplay.innerHTML = `📅 Days until target: <strong>${daysUntil}</strong> days`;
        }
    }
}

// Add event listener for date changes
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('target_date').addEventListener('change', calculateProgress);
});
</script>
{% endblock %}